{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-4">
    <h2>{{ course.title }} - Attendance</h2>
    
    {% if is_teacher %}
    <div class="card mb-4">
        <div class="card-body">
            <h4>Mark Attendance</h4>
            <form id="attendanceForm" method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input type="date" class="form-control" id="date" name="date" required>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive mt-3">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Status</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for enrollment in enrollments %}
                            <tr>
                                <td>{{ enrollment.student.get_full_name }}</td>
                                <td>
                                    <select class="form-control" name="status_{{ enrollment.student.id }}">
                                        <option value="present">Present</option>
                                        <option value="absent">Absent</option>
                                        <option value="late">Late</option>
                                        <option value="excused">Excused</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control" name="notes_{{ enrollment.student.id }}">
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <button type="submit" class="btn btn-primary">Submit Attendance</button>
            </form>
        </div>
    </div>
    {% endif %}
    
    <div class="card">
        <div class="card-body">
            <h4>Attendance Statistics</h4>
            <div class="row">
                <div class="col-md-6">
                    <canvas id="attendanceChart" data-attendance="{{ attendance_data|safe }}"></canvas>
                </div>
                <div class="col-md-6">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Present %</th>
                                    <th>Total Classes</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in attendance_stats %}
                                <tr>
                                    <td>{{ stat.student.get_full_name }}</td>
                                    <td>{{ stat.present_percentage|floatformat:1 }}%</td>
                                    <td>{{ stat.total_classes }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/attendance.js' %}"></script>
{% endblock extra_js %}
<!-- End of content block -->
{% endblock content %}