{% extends 'base.html' %}
{% load static %}
{% load course_filters %}

{% block title %}{{ video.title }} - {{ course.title }}{% endblock %}

{% block extra_css %}
<style>
    .video-container {
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    
    .video-info {
        background-color: var(--card-bg);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .video-title {
        font-size: 1.8rem;
        margin-bottom: 10px;
        color: var(--heading-color);
    }
    
    .course-badge {
        background-color: #6366F1;
        color: white;
        font-size: 0.85rem;
        padding: 5px 10px;
        border-radius: 20px;
        text-decoration: none;
        display: inline-block;
        margin-bottom: 15px;
    }
    
    .course-badge:hover {
        background-color: #4F46E5;
        color: white;
    }
    
    .video-description {
        margin-top: 15px;
        color: var(--text-color);
        line-height: 1.6;
    }
    
    .share-section {
        background-color: var(--card-bg);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .share-url {
        padding: 10px;
        border: 1px solid #ced4da;
        border-radius: 5px;
        width: 100%;
        margin-bottom: 10px;
        font-family: monospace;
        font-size: 0.9rem;
    }
    
    .highlighted-word {
        background-color: rgba(99, 102, 241, 0.1);
        color: #4F46E5;
        padding: 0 2px;
        border-radius: 3px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-lg-9 mx-auto">
            <!-- Navigation -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'course_list' %}">Courses</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'course_detail' course.id %}">{{ course.title }}</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ video.title }}</li>
                </ol>
            </nav>
            
            <!-- Video Player -->
            <div class="video-container mb-4">
                <div class="ratio ratio-16x9">
                    <iframe 
                        src="https://www.youtube.com/embed/{{ video.youtube_video_id }}?rel=0&autoplay=1" 
                        title="{{ video.title }}" 
                        allowfullscreen
                        allow="autoplay; encrypted-media">
                    </iframe>
                </div>
            </div>
            
            <!-- Video Information -->
            <div class="video-info">
                <a href="{% url 'course_detail' course.id %}" class="course-badge">
                    <i class="fas fa-graduation-cap me-1"></i> {{ course.title }}
                </a>
                <h1 class="video-title">{{ video.title }}</h1>
                <div class="video-description">
                    {{ video.description|linebreaks|highlight_content_words }}
                </div>
            </div>
            
            <!-- Share Section -->
            <div class="share-section">
                <h4><i class="fas fa-share-alt me-2"></i> Share this video</h4>
                <p class="text-muted mb-3">Copy this link to share the video with others:</p>
                
                <input type="text" class="share-url" id="videoShareUrl" value="{{ video_url }}" readonly>
                
                <div class="d-flex gap-2">
                    <button class="btn btn-primary" id="copyLinkBtn">
                        <i class="fas fa-copy me-1"></i> Copy Link
                    </button>
                    <button class="btn btn-success" id="shareButton">
                        <i class="fas fa-share-alt me-1"></i> Share
                    </button>
                    <a href="{% url 'course_detail' course.id %}#course-videos" class="btn btn-outline-primary">
                        <i class="fas fa-video me-1"></i> All Course Videos
                    </a>
                </div>
            </div>
            
            {% if user.is_staff %}
            <!-- Admin Actions -->
            <div class="d-flex justify-content-end mt-4">
                <a href="{% url 'edit_course_video' course.id video.id %}" class="btn btn-sm btn-outline-secondary me-2">
                    <i class="fas fa-edit me-1"></i> Edit Video
                </a>
                <a href="{% url 'delete_course_video' course.id video.id %}" class="btn btn-sm btn-outline-danger">
                    <i class="fas fa-trash-alt me-1"></i> Delete Video
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy link functionality
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const videoShareUrl = document.getElementById('videoShareUrl');
        
        copyLinkBtn.addEventListener('click', function() {
            videoShareUrl.select();
            navigator.clipboard.writeText(videoShareUrl.value)
                .then(() => {
                    // Show success message
                    const originalText = copyLinkBtn.innerHTML;
                    copyLinkBtn.innerHTML = '<i class="fas fa-check me-1"></i> Copied!';
                    copyLinkBtn.classList.remove('btn-primary');
                    copyLinkBtn.classList.add('btn-success');
                    
                    setTimeout(() => {
                        copyLinkBtn.innerHTML = originalText;
                        copyLinkBtn.classList.remove('btn-success');
                        copyLinkBtn.classList.add('btn-primary');
                    }, 2000);
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    alert('Failed to copy link. Please try manually selecting and copying the URL.');
                });
        });
        
        // Web Share API
        const shareButton = document.getElementById('shareButton');
        if (shareButton) {
            shareButton.addEventListener('click', async () => {
                try {
                    if (navigator.share) {
                        await navigator.share({
                            title: '{{ video.title }}',
                            text: 'Check out this video from {{ course.title }}: {{ video.title }}',
                            url: '{{ video_url }}'
                        });
                    } else {
                        // Fallback if Web Share API is not available
                        videoShareUrl.select();
                        document.execCommand('copy');
                        alert('Link copied to clipboard!');
                    }
                } catch (error) {
                    console.error('Error sharing:', error);
                }
            });
        }
    });
</script>
{% endblock %}
